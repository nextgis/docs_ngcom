.. _ngcom_ngqgis_connect:

Как управлять данными с помощью настольного приложения NextGIS QGIS
===================================================================

Загружать, редактировать и совершать другие операции с геоданными в :ref:`Веб ГИС <ngcom_description>` можно не только через административный :ref:`веб-интерфейс <ngw_admin_interface>`, но и с помощью настольного приложения `NextGIS QGIS <http://nextgis.ru/nextgis-qgis/>`_.

Для удобного управления вашей Веб ГИС мы создали модуль расширения `NextGIS Connect <https://plugins.qgis.org/plugins/nextgis_connect/>`_. В В `NextGIS QGIS <http://nextgis.ru/nextgis-qgis/>`_ он установлен по умолчанию. При необходимости обновить модуль можно через меню **Модули** -> **Управление модулями** -> **NextGIS Connect**.

NextGIS Connect позволяет обмениваться данными с множеством Веб ГИС из настольного приложения. Для этого необходимо создать к ним соответствующие подключения.


.. _ngcom_ngqgis_connect_connection:

Подключение к Веб ГИС
---------------------

После успешной установки модуля в правой части экрана появится панель :guilabel:`NextGIS Connect`.

Для начала работы **создайте подключение** к своей Веб ГИС:

* Откройте диалог **Настройки** (шестренка) на панели управления NextGIS Connect;
* Нажмите кнопку **Новое**;
* В открывшемся диалоговом окне заполните поля **URL** (веб-адрес вашей Веб ГИС, например, - https://examples.nextgis.com) и **Имя** (будет отображаться в списке доступных подключений). Чтобы получить возможность создавать и удалять ресурсы, снимите галочку в поле *Как гость* и заполните поля **Логин** и **Пароль**, используя данные вашего NextGIS ID;

.. note:: 
   Создавать и удалять ресурсы Веб ГИС может ее владелец и пользователи, добавленные в `команду <https://docs.nextgis.ru/docs_ngcom/source/create.html#ngcom-team-management>`_.
   
* Нажмите кнопку :guilabel:`Ок` и закройте диалоговое онко `Настройки`. В окне модуля появится дерево ресурсов вашей Веб ГИС.

.. figure:: _static/NGConnect_connection.gif
   :name: NG_Connect_connection
   :align: center
   :width: 850px


.. _ngcom_ngqgis_connect_data_upload:

Создание и загрузка данных
------------------------------------------------

Модуль NextGIS Connect позволяет быстро загружать в Веб ГИС растровые и векторные данные, а также целиком проекты QGIS. Это позволит вам легко опубликовать в интернете свои карты и геоданные.

.. _vector_data:

Загрузка векторных данных
~~~~~~~~~~~~~~~~~~~~~~~~~

.. warning:: 
   Вы можете избежать :ref:`ограничений по форматам данных <ngcom_vector_layer>` при загрузке векторных данных в Веб ГИС через NextGIS Connect, применив опции "Переименовывать запрещенные поля" и "Исправлять некорректные геометрии" в диалоге :guilabel:`Настройки`.

* Создайте в QGIS "с нуля" или добавьте из файлов векторные слои :term:`ESRI Shape`, :term:`GeoJSON` или :term:`CSV`. Настройте стили их отображения;
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect :ref:`Группу ресурсов <ngcom_resources_group>`, в которую вы хотите загрузить данные (или создайте её с помощью кнопки "Создать новую группу ресурсов");
* Выберите в панели слоев QGIS векторный слой, который вы хотите загрузить в Веб ГИС;
* Нажмите кнопку **Импортировать выбранный слой** на панели инструментов модуля или выберите **NextGIS Connect --> Импортировать выбранный слой** в контекстном меню слоя;
* Если данные загрузились успешно, то в соответствующей Группе ресурсов появится новый :ref:`Векторный слой <ngcom_data_upload>`, внутри которого будет создан :ref:`Стиль QGIS <ngcom_styles>` с заданными настройками стиля.


.. _raster_data:

Загрузка растровых данных
~~~~~~~~~~~~~~~~~~~~~~~~~

* Добавьте в QGIS из файлов растровые слои :term:`GeoTIFF`;
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect Группу ресурсов, в которую вы хотите загрузить данные;
* Выберите в панели слоев QGIS растровый слой, который вы хотите загрузить в Веб ГИС;
* Нажмите кнопку **Импортировать выбранный слой** на панели инструментов модуля или выберите **NextGIS Connect --> Импортировать выбранный слой** в контекстном меню слоя;
* Если данные загрузились успешно, то в соответствующей Группе ресурсов появится новый :ref:`Растровый слой <ngcom_data_upload>`, внутри которого будет создан :ref:`Растровый стиль <ngcom_styles>` с настройками стиля по умолчанию.


.. _basemaps:

Загрузка базовых карт (подложек)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Добавьте в QGIS базовую карту (подложку);
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect Группу ресурсов, в которую вы хотите добавить подложку;
* Выберите в панели слоев QGIS подложку, которую вы хотите загрузить в Веб ГИС;
* Нажмите кнопку **Импортировать выбранный слой** на панели инструментов модуля или выберите **NextGIS Connect --> Импортировать выбранный слой** в контекстном меню слоя;
* Если подложка загрузилась успешно, то она появится в соответствующей Группе ресурсов.

Для работы с подложками ваша Веб ГИС должна быть на плане **Мини** или **Премиум**, в противном случае вы не сможете импортировать их в Веб ГИС.


.. _qgis_project:

Загрузка проекта QGIS целиком
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Соберите в QGIS проект из растровых и векторных слоев. Настройте их стили отображения, иерархию, группировку, видимость. Настройте охват карты;
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect Группу ресурсов, в которую вы хотите загрузить проект;
* Нажмите кнопку **Импортировать текущий проект** на панели инструментов модуля или выберите **NextGIS Connect --> Импортировать текущий проект** в контекстном меню любого слоя;
* В открывшемся диалоговом окне укажите название новой Группы ресурсов, в которую будет загружен проект;
* Если проект загрузился успешно, то в соответствующей Группе ресурсов появится новая Группа ресурсов с заданным названием, внутри которой будут находиться: 
1) все Растровые и Векторные слои, для которых доступна операция *Импортировать выбранный слой*, а также их Стили;
2) автоматически созданная :ref:`Веб-карта <ngcom_webmap_create>` с заданным охватом, на которую будут добавлены все импортированные слои с учетом их группировки, иерархии и видимости в панели слоёв QGIS.

.. note:: 
	Быстро перейти к Веб-карте можно, нажав кнопку **Открыть карту в браузере** на панели инструментов модуля или выбрав соответствующую команду в контекстном меню Веб-карты.

.. figure:: _static/NGConnect_project_import.gif
   :name: NGConnect_project_import
   :align: center
   :width: 850px


.. _ngcom_ngqgis_connect_services:

Создание Сервисов WFS и WMS
---------------------------

Модуль NextGIS Connect позволяет быстро публиковать Векторные слои в Веб ГИС по стандартным протоколам :term:`WFS` и :term:`WMS`. 

.. _create_wfs_service:

Создание сервиса WFS
~~~~~~~~~~~~~~~~~~~~~

Для этого в модуле доступна операция быстрого создания :ref:`Сервиса WFS <ngcom_wfs_service>`:

* В настольном приложении (NextGIS QGIS) в дереве ресурсов Веб ГИС модуля NextGIS Connect выберите **Векторный слой**, который вы хотите опубликовать по протоколу WFS;
* Выберите пункт **Создать сервис WFS** в контекстном меню слоя;
* В открывшемся диалоговом окне укажите число объектов слоя, которое должен публиковать Сервис WFS;
* Если Сервис WFS создался успешно, то в соответствующей Группе ресурсов появится новый Сервис WFS, в который уже подключен ваш Векторный слой.

.. note:: 
	Отредактировать настройки созданного таким образом Сервиса WFS (включая его название, публикуемые слои и их настройки) можно через веб-интерфейс Веб ГИС.

.. figure:: _static/NGConnect_wfs_service.gif
   :name: NGConnect_wfs_service
   :align: center
   :width: 850px

.. _create_wms_service:

Создание сервиса WMS
~~~~~~~~~~~~~~~~~~~~~

Для этого в модуле доступна операция быстрого создания :ref:`Сервиса WMS <ngcom_wms_service>`:

* В настольном приложении (NextGIS QGIS) в дереве ресурсов Веб ГИС модуля NextGIS Connect выберите **Векторный слой**, который вы хотите опубликовать по протоколу WMS;
* Выберите пункт **Создать WMS сервис** в контекстном меню слоя;
* В открывшемся диалоговом выберите стиль слоя для публикация Сервиса WMS;
* Если Сервис WFS создался успешно, то в соответствующей Группе ресурсов появится новый Сервис WMS, в который уже подключен ваш Векторный слой.


.. _ngcom_ngqgis_connect_data_edit:

Редактирование данных
---------------------

Модуль NextGIS Connect позволяет быстро редактировать геометрии и атрибуты объектов в Векторных слоях Веб ГИС. Это возможно благодаря использованию стандартного протокола :term:`WFS` (с поддержкой редактирования):

* :ref:`Опубликуйте по протоколу WFS <ngcom_ngqgis_connect_wfs_service>` Векторный слой, объекты которого вы хотите отредактировать;
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect соответствующий WFS сервис;
* Нажмите кнопку **Добавить в QGIS** на панели инструментов модуля или выберите пункт **Добавить в QGIS** в контекстном меню сервиса;
* Если операция прошла успешно, то на панели слоев QGIS появится новая группа слоев WFS, опубликованных с помощью добавленного WFS сервиса;
* Отредактируйте геометрии и атрибуты объектов в добавленном слое WFS с помощью :ref:`стандартных инструментов QGIS <ngqgis_editing>`;
* Если редактирование объектов прошло успешно, то соответствующие изменения сразу же будут отображены в Веб ГИС в :ref:`Таблице объектов <ngw_feature_table>` и :ref:`веб-клиенте <ngw_webmaps_client>` Веб-карты.

.. figure:: _static/NGConnect_data_edit.gif
   :name: NGConnect_data_edit
   :align: center
   :width: 850px


.. _ngcom_ngqgis_connect_data_overwrite:

Обновление данных
-----------------

С помощью NextGIS Connect можно обновить содержимое уже существующего векторного слоя Веб ГИС, сохранив его стили, псевдонимы атрибутов и другие настройки.

.. warning:: 
   Все данные целевого слоя, включая вложения (фото, документы), будут очищены. Если вам нужно их сохранить - используйте WFS

Для обновления (замены) данных слоя:

* Выберите на панели слоёв QGIS векторный слой, объекты которого вы хотите отправить в векторный слой Веб ГИС;
* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect векторный слой, объекты которого вы хотите заменить;
* Щелкните правой кнопкой выши по выбранному векторному слою в окне NextGIS Connect и выберите **Перезаписать выбранный слой**.

Идентификатор ресурса слоя при этом останется неизменным. Операция подозревает что слой источник и целевой слой имеют одинаковую структуру атрибутов.

   
.. figure:: _static/connect_vector_overwrite.png
   :name: connect_vector_overwrite
   :align: center
   :width: 850px


.. _ngcom_ngqgis_connect_style_overwrite:

Обновление стиля
-----------------

* Добавьте слой в NextGIS QGIS через Connect
* Измените стиль вашего слоя (цвет, толщина линий и так далее)
* Далее выберите **Импорт/Обновление стиля**, выделив в правой панели **стиль** нужного ресурса

После данных операций модуль NextGIS Connect удалит старый стиль вашего слоя из веб ГИС и загрузит новый, оставив при этом нетронутыми данные и вложения.

.. _ngcom_ngqgis_connect_data_export:

Экспорт данных
--------------

Модуль NextGIS Connect позволяет быстро экспортировать векторные данные из Веб ГИС в NextGIS QGIS для их последующей обработки, анализа, выгрузки и иных операций.

Для этого в модуле доступна операция быстрого создания векторных слоев GeoJSON в QGIS с использованием данных Векторных слоев Веб ГИС:

* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect Векторный слой, который вы хотите экспортировать в QGIS;
* Нажмите кнопку **Добавить в QGIS** на панели инструментов модуля или выберите пункт **Добавить в QGIS** в контекстном меню слоя;
* Если слой экспортировался успешно, то в панели слоев QGIS появится новый векторный слой GeoJSON, который можно использовать в текущих проектах или сохранить на устройство в нужном формате.

.. note:: 
	Поддерживается экспорт геометрий и атрибутов объектов. Стили слоев, описания, метаданные и изображения объектов вышеописанным способом не экспортируются.

.. figure:: _static/NGConnect_data_export.gif
   :name: NGConnect_data_export
   :align: center
   :width: 850px

.. _ngcom_ngqgis_connect_resource_group:

Создание Групп ресурсов
-------------------------------------------------------------------

Модуль NextGIS Connect позволяет быстро создавать новые Группы ресурсов в Веб ГИС. Для этого:

* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect Группу ресурсов, в которой вы хотите создать новую Группу;
* Нажмите кнопку **Создать новую группу ресурсов** на панели инструментов модуля или выберите пункт **Создать новую группу** в контекстном меню;
* В открывшемся диалоговом окне укажите имя новой Группы ресурсов;
* Если Группа ресурсов создалась успешно, то она появится в дереве ресурсов Веб ГИС.

.. _ngcom_ngqgis_connect_resource_delete:

Удаление ресурсов
--------------------------------------------------------

Модуль NextGIS Connect позволяет быстро создавать / удалять любые ресурсы из Веб ГИС. Для этого:

* Выберите в дереве ресурсов Веб ГИС в окне модуля NextGIS Connect ресурс, который вы хотите удалить;
* Выберите пункт **Удалить** в контекстном меню;
* Если ресурс удалился успешно, то он исчезнет из дерева ресурсов Веб ГИС.


Больше информации о модуле расширения NextGIS Connect - :ref:`здесь <ng_connect>`. 
